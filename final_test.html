<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>最終テスト - 合駒生成確認</title>
</head>
<body>
    <h1>合駒生成の最終テスト</h1>
    <p>Nanoha-tsume.htmlを開いて以下の手順でテストしてください：</p>
    
    <h2>テスト手順</h2>
    <ol>
        <li>ブラウザの開発者ツール（F12）を開く</li>
        <li>コンソールタブを選択</li>
        <li>以下の配置を設定：
            <ul>
                <li>△５一玉（後手玉）</li>
                <li>△４二銀（後手銀）</li>
                <li>▲２二飛（先手飛車）</li>
                <li>▲持駒：銀1枚</li>
            </ul>
        </li>
        <li>「詰みを解く」ボタンをクリック</li>
    </ol>
    
    <h2>確認ポイント</h2>
    <pre id="checkpoints"></pre>
    
    <h2>期待される結果</h2>
    <pre id="expected"></pre>
    
    <script>
        const checkpoints = document.getElementById('checkpoints');
        checkpoints.textContent = `
1. デバッグログで「▲２一飛成」または「▲２一飛」が生成されているか？
   → 両方生成されていれば OK

2. その後の回避手生成で以下が表示されるか？
   - "回避手生成開始 - 後手玉: ５一"
   - "王手している駒: 龍 at ２一" または "飛 at ２一"
   - "合駒チェック開始"
   - "→ 飛び駒による王手なので合駒を検討"

3. 合駒候補位置として以下が表示されるか？
   - "合駒候補位置: ４一 [0,4]"
   - "合駒候補位置: ３一 [0,5]"

4. ３一について以下が表示されるか？
   - "→ ３一は空きマス、合駒を検討"
   - "後手が使える駒: 歩, ..." （歩が含まれている）
   - "歩を３一に打つことを検討"
   - "→ 有効な合駒: △３一歩打"

5. 最終的に詰み手順として以下が表示されるか？
   ▲２一飛成 → △３一歩打 → ▲５二銀打
`;

        const expected = document.getElementById('expected');
        expected.textContent = `
正常に動作している場合：
- 3手詰めと判定される
- 手順に△３一歩（合駒）が含まれる
- 最終手は▲５二銀打

現在の問題：
- 合駒（△３一歩）が生成されていない可能性
- canGoteUsePiece('歩')が false を返している可能性
- 合駒チェックのロジックが正しく実行されていない可能性

デバッグ方法：
1. コンソールで以下を実行してみる：
   engine.debugMode = true;
   engine.canGoteUsePiece('歩');
   
2. 盤面設定後、以下を実行：
   engine.board[0][5]  // ３一が空きか確認（null なら空き）
   engine.mochiGoma   // 持駒の状態確認
`;
    </script>
</body>
</html>